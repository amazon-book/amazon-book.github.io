'use strict';mix_d("MorpheusPopularityRankSidesheetCards__morpheus-popularity-rank-sidesheet-card:morpheus-popularity-rank-sidesheet-card__ulMseMLK","exports tslib @c/browser-operations @c/logger @c/metrics @c/scoped-dom @p/monarch-sidesheet @c/remote-operations".split(" "),function(E,z,M,N,n,O,P,Q){function t(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var R=t(M),y=t(N),p=t(O),q=t(P),F=t(Q),A;(function(a){a.asinItemClickMetricReportHandler="asinItemClickMetricReportHandler";a.aodLinkClickHandler=
"aodLinkClickHandler"})(A||(A={}));var G=A,B=function(a){var b=0,e=setInterval(function(){5<b&&clearInterval(e);b++;var d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_header__1CUj_")[0],f=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0];if(d||f)clearInterval(e),a.focus()},500)},H=function(a){var b=0,e=setInterval(function(){5<b&&clearInterval(e);b++;var d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_item_link__1pKM-")[0];
d&&(clearInterval(e),d.focus())},500)},I=function(a){var b=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_err-view__V9B13")[0];a&&b&&(a.innerHTML=b.innerHTML)},r=function(a){a&&(a.style.display="none")},u=function(a,b){return b?a+"T1":a+"C"},J=new Map([["kindle_meta_binding","Kin"],["audiobooks_digital_meta_binding","Aud"],["hardcover_meta_binding","Hrd"],["paperback_meta_binding","Pap"],["mass_market_paperback_meta_binding","Mmp"],["audiobooks_meta_binding",
"Abk"]]),K=function(a){return J.has(a)?"morpheusSidesheetTabClicked"+J.get(a):"morpheusSidesheetTabClickedOther"},v,w=function(){var a;return 0<(null===(a=p["default"].cardRoot.getElementsByClassName("isPopularityWeblabEnabled"))||void 0===a?void 0:a.length)},V=function(a){a.preventDefault();var b=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0],e=p["default"].cardRoot.getElementsByClassName("landingAsinValue")[0];if(b&&e&&e.value){a=
p["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];!v&&a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0]&&q["default"].setContent("");var d=Date.now();n.count("seeAllFormatsExpanderClicked",1);n.count(u("seeAllFormatsExpanderClicked",w()),1);q["default"].show();if(v)B(b);else{var f=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_content-ctr__jbXAx")[0],m=function(){q["default"].setContent(f.innerHTML);
S(b);T(b);var h=R["default"].setup().define;h(G.asinItemClickMetricReportHandler,"click",function(c){var k,l,x,C;c=c.target.parentElement;var U="true"===(null===(k=null===c||void 0===c?void 0:c.dataset)||void 0===k?void 0:k.newRelease);k="true"===(null===(l=null===c||void 0===c?void 0:c.dataset)||void 0===l?void 0:l.popularityEnabled);U&&n.count(k?"morpheusNewReleasedItemClickedWithBadge":"morpheusNewReleasedItemClickedNoBadge",1);n.count("morpheusEditionItemClicked",1);n.count(u("morpheusEditionItemClicked",
w()),1);l="true"===(null===(x=null===c||void 0===c?void 0:c.dataset)||void 0===x?void 0:x.isPopular);x="true"===(null===(C=null===c||void 0===c?void 0:c.dataset)||void 0===C?void 0:C.isPopularBadgeWeblabEnabled);l&&k&&n.count(x?"morpheusPopularItemClickedWithBadge":"morpheusPopularItemClickedNoBadge",1)});h(G.aodLinkClickHandler,"click",function(c){var k;c=c.target;c.classList.contains("morpheusAodEntryLink")&&!c.classList.contains("morpheusAodDeclarativeAction")&&(q["default"].closeSidesheet(c.id),
c=null===(k=c.parentElement)||void 0===k?void 0:k.getElementsByClassName("morpheusAodDeclarativeAction")[0])&&(c.click(),n.count("morpheusAODClicked",1),n.count(u("morpheusAODClicked",w()),1))});h=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR");for(var g=0;g<h.length;g++)h[g].getElementsByClassName("sidesheetAsinListContainer")[0]&&L(e.value,h[g]);h=Date.now()-d;n.count("morpheusSidesheetContentLoadLatency",h);v=!0};F["default"].setup().getSidesheetHtml({asin:e.value}).then(function(h){f&&
(f.innerHTML=h.outerHTML,m(),B(b))}).catch(function(h){I(f);q["default"].setContent(f.innerHTML);v=!1;n.count("failedRenderSidesheetContent",1);B(b);y["default"].log("Experiencing some issues to load sidesheet view for ASIN "+e.value+", trace: "+h,"ERROR")})}}else y["default"].log("Not able to open see all formats sidesheet, missing neccessary component.","FATAL")},D=function(a,b,e,d){var f=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content-spinner__3lJtW")[0],m=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0],
h=a.getElementsByClassName("sidesheetAsinListContainer")[0];r(h);r(m);f&&(f.style.display="inline-block");F["default"].setup().getMetabindingTabContentHtml({asin:b,totalPageNumber:e,currentPageNumber:d?d:1}).then(function(g){a.innerHTML=g.innerHTML;L(b,a,e);H(a)}).catch(function(g){I(a);r(f);a.innerHTML+=f.outerHTML;n.count("failedRenderMetabindingTabContent",1);y["default"].log("Experiencing some issues to load tab content view, trace: "+g,"ERROR")})},S=function(a){var b=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z"),
e=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR"),d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];d=null===d||void 0===d?void 0:d.getElementsByClassName("metabindingSymbol")[0];"audiobooks_digital_meta_binding"===(null===d||void 0===d?void 0:d.value)&&(n.count("seeAllFormatsExpanderClickedAud",1),a.getElementsByClassName("isLoggedInCustomer")[0]&&n.count("seeAllFormatsExpanderClickedAudLoggedIn",1));d=function(m){var h=
e[m].getElementsByClassName("a-box-inner")[0];h&&(h.style.padding="0");b[m].addEventListener("click",function(){var g=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];if(g!==b[m]){var c=b[m].getElementsByClassName("metabindingSymbol")[0];c&&c.value&&(n.count(K(c.value),1),n.count(u(K(c.value),w()),1),"audiobooks_digital_meta_binding"===c.value&&a.getElementsByClassName("isLoggedInCustomer")[0]&&n.count("morpheusSidesheetTabClickedAudLoggedIn",1));b[m].className=
"_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z _morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd";g.className="_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z";g=e[m];if((c=g.getElementsByClassName("sidesheetAsinListContainer")[0])&&"none"!==c.style.display)H(g);else{c=b[m].getElementsByClassName("winningAsin")[0];var k=b[m].getElementsByClassName("totalPages")[0];D(g,c.value,Number(k.value))}}})};for(var f=0;f<b.length;f++)d(f)},T=function(a){var b=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-row__1Uxai")[0],
e=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back__2cqlo")[0],d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw__2NDFi")[0];if(e&&d&&b){var f=e.offsetLeft>d.offsetLeft;f&&(e.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back-radius__2TGra"),d.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw-radius__3O1Mg"));var m=!1,h=f&&3<b.scrollLeft,g;r(e);var c=function(){return h?3>=Math.abs(b.scrollLeft):
3>=b.scrollWidth-Math.abs(b.scrollLeft)-b.offsetWidth},k=function(){return h?3>=b.scrollWidth-Math.abs(b.scrollLeft)-b.offsetWidth:3>=Math.abs(b.scrollLeft)};c()&&r(d);b.addEventListener("scroll",function(){c()&&"none"!==d.style.display?(r(d),clearInterval(g)):!c()&&"none"===d.style.display&&d&&(d.style.display="inline-block");k()&&"none"!==e.style.display?(r(e),clearInterval(g)):!k()&&"none"===e.style.display&&e&&(e.style.display="inline-block")});d.addEventListener("mousedown",function(){g=setInterval(function(){var l=
b.scrollLeft;f&&!m?b.scrollLeft-=3:b.scrollLeft+=3;f&&!m&&0===l&&0===b.scrollLeft&&(m=!0,b.scrollLeft+=3)},10)});d.addEventListener("mouseup",function(){clearInterval(g)});e.addEventListener("mousedown",function(){g=setInterval(function(){f&&!m?b.scrollLeft+=3:b.scrollLeft-=3},10)});e.addEventListener("mouseup",function(){clearInterval(g)})}},L=function(a,b,e){for(var d=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_pagination__4GE1X")[0],f=b.getElementsByClassName("a-pagination")[0].getElementsByTagName("li"),
m=function(g){var c=f[g];c.classList.contains("a-disabled")||c.addEventListener("click",function(k){k.preventDefault();k=c&&c.classList.contains("a-selected");var l;0===g&&d.dataset.prevPageNumber?l=Number(d.dataset.prevPageNumber):g===f.length-1&&d.dataset.nextPageNumber?l=Number(d.dataset.nextPageNumber):c&&c.dataset.pageNumber&&(l=Number(c.dataset.pageNumber));c&&!k&&l&&(n.count("morpheusSidesheetOtherPageNavigated",1),n.count(u("morpheusSidesheetOtherPageNavigated",w()),1),e?D(b,a,e,l):(k=f[f.length-
2])&&k.dataset.pageNumber&&D(b,a,Number(k.dataset.pageNumber),l))})},h=0;h<f.length;h++)m(h)};E._operationNames=["getSidesheetHtml","getMetabindingTabContentHtml"];E.card=function(){return z.__awaiter(void 0,void 0,void 0,function(){var a,b,e,d,f,m,h,g,c;return z.__generator(this,function(k){a=p["default"].cardRoot.getElementsByClassName("morpheusRoot")[0];if(!a)return[2];e=(b=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_saf__39PV9")[0])?b:p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_saf-link__2TS-U")[0];
d=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0];f=p["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];m=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_overlay__T88OB")[0];h=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_spinner__VHgKZ")[0];g=p["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet-close__13oI1")[0];
c=[d,f,m,h,g];if(c.every(function(l){return l})&&c.map(function(l){return l.id}).every(function(l){return l}))q["default"].initialize.apply(q["default"],z.__spread(c.map(function(l){return l.id}))),g.tabIndex=0;else return y["default"].log("Not able to initialize see all formats sidesheet, missing neccessary component or component id.","FATAL"),[2];v=!1;e&&e.addEventListener("click",V);return[2]})})}});
