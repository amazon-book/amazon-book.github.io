(function(d){var c=window.AmazonUIPageJS||window.P,g=c._namespace||c.attributeErrors,a=g?g("StarlingInterestGroupAssignment",""):c;a.guardFatal?a.guardFatal(d)(a,window):a.execute(function(){d(a,window)})})(function(d,c,g){d.register("StarlingIGJoinConfiguration",function(){return{getRoboticSessionId:function(){return"000-0000000-0000000"},getSecondsPerDay:function(){return 86400},getToken:function(a){switch(a){case "gamma":return"A3NCr8P3b4bphoI4ddXo62kjJE+2Pvsn0XussvUJBWUV1CAaU84jhrQcNmXQfqRf2N6L4BEaDAvtTmGLsSMHOAsAAACJeyJvcmlnaW4iOiJodHRwczovL3ByZS1wcm9kLmFtYXpvbi5jb206NDQzIiwiZmVhdHVyZSI6IlByaXZhY3lTYW5kYm94QWRzQVBJcyIsImV4cGlyeSI6MTY4ODA4MzE5OSwiaXNTdWJkb21haW4iOnRydWUsImlzVGhpcmRQYXJ0eSI6dHJ1ZX0\x3d";
case "prod":return"A1ZuudJAyStrz04rn6qN6wKO4Z+jLb3xT7BXazMW8G6hp4Gb2yBAwOIYY3Zs3XipJjwtXGLD8wqGFYkA5uzA0w8AAACEeyJvcmlnaW4iOiJodHRwczovL3d3dy5hbWF6b24uY29tOjQ0MyIsImZlYXR1cmUiOiJQcml2YWN5U2FuZGJveEFkc0FQSXMiLCJleHBpcnkiOjE2ODgwODMxOTksImlzU3ViZG9tYWluIjp0cnVlLCJpc1RoaXJkUGFydHkiOnRydWV9"}},getUserAgent:function(){return navigator.userAgent}}});"use strict";d.register("StarlingAddMetric",function(){return{addMetric:function(a,b){c.ue&&c.ue.count&&c.ue.count(a,b)}}});"use strict";d.register("StarlingLogError",
function(){return{logError:function(a){var b={logLevel:2<arguments.length&&arguments[2]!==g?arguments[2]:"ERROR",attribution:"StarlingInterestGroupAssignment",message:1<arguments.length&&arguments[1]!==g?arguments[1]:""};c.ueLogError&&c.ueLogError(a,b);return[a,b]}}});"use strict";d.when("StarlingIGJoinConfiguration","StarlingAddMetric","StarlingLogError").register("StarlingIGJoinHelpers",function(a,b,f){function l(){return c.opts.customerId}function d(a){switch(a){case "beta":return"https://at-"+
a+".amazon-adsystem.com";case "gamma":return"https://at-"+a+"-us-east.amazon-adsystem.com";case "prod":return"https://at-us-east.amazon-adsystem.com"}}function r(a){if(a){if((a=a.interestGroups)&&Array.isArray(a)&&0<a.length)return b.addMetric("Starling:AttemptedIGAdd",a.length),a;b.addMetric("Starling:GatewayReturnedIGMetadata:False",1);a={message:"Starling:GatewayReturnedIGMetadata:False. IG Metadata from Gateway is empty or incorrect format."};f.logError(a);return null}b.addMetric("Starling:NullGatewayResponseError",
1);a={message:"Starling:NullGatewayResponseError. Null IGMetadata response from Gateway."};f.logError(a)}function m(a,b){return new Promise(function(h,e){try{navigator.joinAdInterestGroup(a,30*b),h()}catch(k){e(k)}})}function n(a,b){var h=[],e=!0,f=!1,c=g;try{for(var l=a[Symbol.iterator](),d;!(e=(d=l.next()).done);e=!0)h.push(m(d.value,b))}catch(v){f=!0,c=v}finally{try{!e&&l.return&&l.return()}finally{if(f)throw c;}}return h}function p(a,e){var h=0,c=0;a=n(a,e);Promise.allSettled(a).then(function(a){var e=
!0,f=!1,d=g;try{for(var k=a[Symbol.iterator](),q;!(e=(q=k.next()).done);e=!0)"fulfilled"===q.value.status?h+=1:c+=1}catch(w){f=!0,d=w}finally{try{!e&&k.return&&k.return()}finally{if(f)throw d;}}b.addMetric("Starling:BrowserAddedToIG:True",h);b.addMetric("Starling:BrowserAddedToIG:False",c);l()?b.addMetric("Starling:IGAssigned:AmazonCustomer",h):b.addMetric("Starling:IGAssigned:AmazonGuest",h)}).catch(function(a){b.addMetric("Starling:PromiseResolverError",1);f.logError(a,"Starling:PromiseResolveError. Error resolving IGJoinPromiseArray.")})}
function t(a){try{return c.localStorage.getItem(a)}catch(e){return null}}function u(a,e){try{a=String(a),e=String(e),c.localStorage.setItem(a,e)}catch(C){}}var x=/development|beta/,y=/pre-prod|gamma/,z=/chrome|chromium|crios/i,A=/opr\//i,B=/edg/i;return{isChrome:function(){var b=a.getUserAgent(),e=!1;b&&(b.match(z)&&(e=!0),b.match(A)?e=!1:b.match(B)&&(e=!1));return e},browserSupportsAdInterestGroup:function(){return"joinAdInterestGroup"in navigator&&document.featurePolicy.allowsFeature("join-ad-interest-group")},
getWindowOpts:function(){return c.opts},getHref:function(){return c.location.href},getCustomerId:l,getApnPrivacySetting:function(){if(null!==document&&null!==document.cookie){var a=document.cookie.match(/(^| )apn-privacy=([^;]+)/);if(a)return"true"===a[2]}return!1},getStage:function(a){return x.test(a)?"beta":y.test(a)?"gamma":"prod"},generateGatewayUrl:d,provideToken:function(a){if(null!==document&&null!==document.head){var b=document.createElement("meta");b.httpEquiv="origin-trial";b.content=a;
document.head.appendChild(b)}},parseIGMetadataFromResponse:r,createIGJoinPromise:m,createIGJoinPromiseArray:n,settleIGJoinPromises:p,joinAdInterestGroups:function(c,e){var l=a.getSecondsPerDay();e=d(e)+"/interestGroups/join/";var h=t("timestampForNextRequest"),k=h?Number(h):0;0==k||k<(new Date).getTime()?fetch(e,{method:"PUT",body:JSON.stringify(c),credentials:"include"}).then(function(a){b.addMetric("Starling:ReceivedGatewayResponse",1);return a.json()}).then(function(a){var b=JSON.parse(JSON.stringify(a));
a=r(b);if(b=b.throttleTimeForNextRequest)k=0==b?0:Number(b)+(new Date).getTime(),u("timestampForNextRequest",k);a&&p(a,l)}).catch(function(a){b.addMetric("Starling:ParseGatewayResponseError",1);f.logError(a,"Starling:ParseGatewayResponseError. Error parsing IG Metadata from Gateway.")}):b.addMetric("Starling:ThrottledIGJoinRequests",1)},lookupLocalStorage:t,addToLocalStorage:u,removeFromLocalStorage:function(a){try{c.localStorage.getItem(a)!==g&&c.localStorage.removeItem(a)}catch(e){}}}});"use strict";
d.register("StarlingInterestGroupAssign",function(){var a={init:function(b,f,c,d){a.config=b;a.helpers=d;a.metrics=f;a.errors=c;b=a.config.getRoboticSessionId();f=a.helpers.getHref();a.helpers.isChrome()&&(f?(f=a.helpers.getStage(f),c=a.config.getToken(f),a.helpers.provideToken(c),a.assignIG(f,b)):(a.metrics.addMetric("Starling:PageLoadError",1),a.errors.logError({message:"Starling:PageLoadError. Error retreiving url from window."})))},assignIG:function(b,c){if(a.helpers.browserSupportsAdInterestGroup()){a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:True",
1);var d=a.helpers.getWindowOpts();if(d){var f=d.sessionId,g=d.pageType;d=d.asin;var m=a.helpers.getApnPrivacySetting(),n=a.helpers.getHref;c=f===c;var p=a.helpers.getCustomerId();m||c?a.metrics.addMetric("Starling:TotalPunts",1):a.helpers.joinAdInterestGroups({identity:{customerId:p,sessionId:f},pageInformation:{pageURL:n,pageType:g,asins:[d]}},b);m&&a.metrics.addMetric("Starling:UserOptedOut:True",1);c&&a.metrics.addMetric("Starling:RoboticTraffic:True",1);a.helpers.getCustomerId()?a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonCustomer",
1):a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:AmazonGuest",1)}else a.metrics.addMetric("Starling:OptsNotFoundError",1),a.errors.logError({message:"Starling:OptsNotFoundError. Error getting windowOpts."})}else a.metrics.addMetric("Starling:BrowserSupportsAdInterestGroup:False",1)}};return a});d.when("StarlingIGJoinConfiguration","StarlingAddMetric","StarlingLogError","StarlingIGJoinHelpers","StarlingInterestGroupAssign","ready").execute(function(a,b,c,d,g){g.init(a,b,c,d)})});